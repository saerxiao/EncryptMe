<html lang="en">
<head>
  <style type="text/css">
  body {
  background-color :#f5f5f5;
  width: 600px;
  margin: 0 auto;
  padding: 0;
}

  </style>
</head>
<script src="aes_rollup.js"></script>

<script>
var JsonFormatter = {
        stringify: function (cipherParams) {
            // create json object with ciphertext
            var jsonObj = {
                ct: cipherParams.ciphertext.toString(CryptoJS.enc.Hex)
            };

            //add iv and salt
            if (cipherParams.iv) {
                jsonObj.iv = cipherParams.iv.toString();
            }
            if (cipherParams.salt) {
                jsonObj.s = cipherParams.salt.toString();
            }

            // stringify json object
            return jsonObj;
        },

        parse: function (jsonObj) {
            // extract ciphertext from json object, and create cipher params object
            var cipherParams = CryptoJS.lib.CipherParams.create({
                ciphertext: CryptoJS.enc.Hex.parse(jsonObj.ct)
            });

            // extract iv and salt
            if (jsonObj.iv) {
                cipherParams.iv = CryptoJS.enc.Hex.parse(jsonObj.iv)
            }
            if (jsonObj.s) {
                cipherParams.salt = CryptoJS.enc.Hex.parse(jsonObj.s)
            }

            return cipherParams;
        }
};  

var stringFormatter = {
	stringify: function (cipherParams) {
            // create json object with ciphertext
            var jsonObj = {
                ct: cipherParams.ciphertext.toString(CryptoJS.enc.Hex)
            };

            // add iv and salt
            if (cipherParams.iv) {
                jsonObj.iv = cipherParams.iv.toString();
            }
            if (cipherParams.salt) {
                jsonObj.s = cipherParams.salt.toString();
            }

            return jsonObj;
    },

    parse: function (saltCipherStr) {
	    console.log("custom formatter ...");
    	var ct = saltCipherStr.substring(16+32);
	// extract ciphertext from json object, and create cipher params object
      var cipherParams = CryptoJS.lib.CipherParams.create({
        	ciphertext: CryptoJS.enc.Hex.parse(ct)
      });
	   cipherParams.salt = CryptoJS.enc.Hex.parse(saltCipherStr.substring(0,16));
	   return cipherParams;
    }
}

  function encrypt() {
    var plain = document.getElementById("plain").value;
    var pwd = document.getElementById("pw").value;
    var encrypted = CryptoJS.AES.encrypt(plain, pwd);  
    document.getElementById("cipher").value = encrypted.salt.concat(encrypted.iv).concat(encrypted.ciphertext);
  };

  function decrypt(){
	  var saltCipher = document.getElementById("cipher").value;
	  var pwd = document.getElementById("pw").value;	  	
  	var decrypted = CryptoJS.AES.decrypt(saltCipher, pwd, {format: stringFormatter});
    document.getElementById("plain").value = decrypted.toString(CryptoJS.enc.Utf8);
  };
</script>

<body>
   <table name = "t" id="t" align="center">
  <tr>
    <td>
      	<label >Instructions:</label>
    </td>
  </tr>
	<tr>
  <tr>
    <td>
      <ul class="list"> 
        <li>You can use this utility to convert the encrypted text generated by EncryptMe to the plain text. Simply copy everything from EncryptMe/account_pwd_note.txt and paste into the "Encrypted Text" box. Enter the ame password as what you used for encryption in EncryptMe, and hit "Decrypt", the plain text will be shown in the "Plain Text" box.</li>
        <li>You can also use this utility to convert the plain text to encrypted text, which can be decrypted by EncryptMe. Simply put your plain text into the "Plain Text" box, enter a password and hit "Encrypt". The encrypted text will be generated in the "Encrypted Text" box. Ovverride the EncryptMe/account_pwd_note.txt with the content in the "Encrypted Text" box. You will be able to decrypt the file with the same password in EncryptMe.</li>
      </ul>
    </td>
  </tr>
   <td>
      <label for="pw">Password</label>
      <input type="password" name="pw" id="pw" STYLE=" background-color: #f5f5f5;">
  <button type="button" name="encrypt" id="encrypt"
        onClick='encrypt()'>Encrypt</button>
    <button type="button" name="decrypt" id="decrypt"
        onClick='decrypt()'>Decrypt</button>
   </td>
 </tr>
<tr>
<td>
	<label for="pt"  style="font-size: 12pt;">Encrypted Text</label>
</td>
</tr>
<tr>
<td>
      <textarea name="cipher" id="cipher" class="w36" rows="25" cols="80"  STYLE=" background-color: #f5f5f5;"></textarea>
</td>
</tr>  
<tr>
	<td>
		<label  style="font-size: 12pt;">Plain Text</label>
	</td>
</tr>
    <tr>
<td>
      <textarea name="plain" id="plain" class="w36" rows="25" cols="80" STYLE=" background-color: #f5f5f5; font-family: courier, monospace;"></textarea>
 </td>
 </tr>
  

 </table>
</body>
</html>
